<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.bluer.moment.mapper.MomentFollowMapper">

    <resultMap type="top.bluer.moment.entity.MomentFollow" id="MomentFollowMap">
        <result property="id" column="id" jdbcType="VARCHAR"/>
        <result property="followersId" column="followers_id" jdbcType="VARCHAR"/>
        <result property="followedId" column="followed_id" jdbcType="VARCHAR"/>
        <result property="time" column="time" jdbcType="TIMESTAMP"/>
        <result property="status" column="status" jdbcType="INTEGER"/>
    </resultMap>

    <!--查询单个-->
    <select id="queryById" resultMap="MomentFollowMap">
        select id,
               followers_id,
               followed_id,
               time,
               status
        from moment_follow
        where id = #{id}
    </select>

    <!--列表查询-->
    <select id="list" resultMap="MomentFollowMap">
        select *
        from moment_follow
        <where>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
            <if test="followersId != null and followersId != ''">
                and followers_id = #{followersId}
            </if>
            <if test="followedId != null and followedId != ''">
                and followed_id = #{followedId}
            </if>
            <if test="time != null">
                and time = #{time}
            </if>
            <if test="status != null">
                and status = #{status}
            </if>
        </where>
        order by time desc
    </select>

    <!--统计总行数-->
    <select id="count" resultType="java.lang.Long">
        select count(1)
        from moment_follow
        <where>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
            <if test="followersId != null and followersId != ''">
                and followers_id = #{followersId}
            </if>
            <if test="followedId != null and followedId != ''">
                and followed_id = #{followedId}
            </if>
            <if test="time != null">
                and time = #{time}
            </if>
            <if test="status != null">
                and status = #{status}
            </if>
        </where>
    </select>
    <!--查询单条-->
    <select id="queryOne" resultMap="MomentFollowMap">
        select *
        from moment_follow
        <where>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
            <if test="followersId != null and followersId != ''">
                and followers_id = #{followersId}
            </if>
            <if test="followedId != null and followedId != ''">
                and followed_id = #{followedId}
            </if>
            <if test="time != null">
                and time = #{time}
            </if>
            <if test="status != null">
                and status = #{status}
            </if>
        </where>
    </select>

    <!--新增所有列-->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into moment_follow(id, followers_id, followed_id, time, status)
        values (#{id}, #{followersId}, #{followedId}, #{time}, #{status})
    </insert>

    <insert id="insertBatch" keyProperty="id" useGeneratedKeys="true">
        insert into moment_follow(followers_id, followed_id, time, status)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.followersId}, #{entity.followedId}, #{entity.time}, #{entity.status})
        </foreach>
    </insert>

    <insert id="insertOrUpdateBatch" keyProperty="id" useGeneratedKeys="true">
        insert into moment_follow(followers_id, followed_id, time, status)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.followersId}, #{entity.followedId}, #{entity.time}, #{entity.status})
        </foreach>
        on duplicate key update
        followers_id = values(followers_id),
        followed_id = values(followed_id),
        time = values(time),
        status = values(status)
    </insert>

    <!--通过主键删除-->
    <update id="deleteById">
        update moment_follow
        set status = 1
        where id = #{id}
    </update>

</mapper>

